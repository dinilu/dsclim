<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>3. Downscaling with crossvalidation • dsclim</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="3. Downscaling with crossvalidation">
<meta name="description" content="Run downscaling with crossvalidation to evaluate model performance.
">
<meta property="og:description" content="Run downscaling with crossvalidation to evaluate model performance.
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dsclim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a1_Data_downloading_and_preprocessing.html">1. Data downloading and preprocessing</a></li>
    <li><a class="dropdown-item" href="../articles/a2_Load_source_data.html">2. Load source data</a></li>
    <li><a class="dropdown-item" href="../articles/a3_Downscale_with_Cross-validation.html">3. Downscaling with crossvalidation</a></li>
    <li><a class="dropdown-item" href="../articles/a4_Downscale_climate_data.html">4. Downscaling climate data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dinilu/dsclim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>3. Downscaling with crossvalidation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dinilu/dsclim/blob/master/vignettes/a3_Downscale_with_Cross-validation.Rmd" class="external-link"><code>vignettes/a3_Downscale_with_Cross-validation.Rmd</code></a></small>
      <div class="d-none name"><code>a3_Downscale_with_Cross-validation.Rmd</code></div>
    </div>

    
    
<p>Here, we document the downscaling process with crossvalidation of
Trace-21ka paleoclimate data using the UERRA dataset for the historical
period. This evaluation allows us to test several configurations of the
downscaling process and select the optimal ones to run the downscaling
of the whole dataset.</p>
<p>More information can be found <a href="https://github.com/SantanderMetGroup/notebooks/blob/master/2019_downscaleR_GMD.pdf" class="external-link">here</a>,
<a href="https://github.com/SantanderMetGroup/notebooks" class="external-link">here</a>, and
<a href="https://github.com/SantanderMetGroup/downscaleR/wiki" class="external-link">here</a>.</p>
<div class="section level2">
<h2 id="downscaling">Downscaling<a class="anchor" aria-label="anchor" href="#downscaling"></a>
</h2>
<p>The downscaling process will be divided in several steps.</p>
<div class="section level3">
<h3 id="defining-variables-and-folds-for-crossvalidation">Defining variables and folds for crossvalidation<a class="anchor" aria-label="anchor" href="#defining-variables-and-folds-for-crossvalidation"></a>
</h3>
<p>Let start by loading the R package <code>dsclim</code>. Then, we
create a vector (<code>vars</code>) containing the names of several
climate variables to be used as predictors in the downscaling process.
The variable <code>local.var</code> is assigned the value “tasmin”,
which is the variable that we aim to downscale in the first place. The
next line creates a list of six elements containing the years 1961 to
1990 split into five-year groups, this is where we are defining the
years to be used in the crossvalidation. To do so, we will fit one
downscaling model for each of the five years period using data from the
rest of the years and using this period to evaluate/validate the model.
Hence, we will fit six models. Finally, the <code>trace.dir</code>
variable is set to the path of a directory containing TraCE21ka
data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dinilu/dsclim" class="external-link">dsclim</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"tas"</span>, <span class="st">"tasmax"</span>, <span class="st">"tasmin"</span>, <span class="st">"hurs@992.5561"</span>, <span class="st">"ps"</span>,</span>
<span>  <span class="st">"pr"</span>, <span class="st">"cld"</span>, <span class="st">"wss"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">local.var</span> <span class="op">&lt;-</span> <span class="st">"tasmin"</span></span>
<span></span>
<span><span class="va">folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1961</span><span class="op">:</span><span class="fl">1965</span>, <span class="fl">1966</span><span class="op">:</span><span class="fl">1970</span>, <span class="fl">1971</span><span class="op">:</span><span class="fl">1975</span>, <span class="fl">1976</span><span class="op">:</span><span class="fl">1980</span>, <span class="fl">1981</span><span class="op">:</span><span class="fl">1985</span>, <span class="fl">1986</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trace.dir</span> <span class="op">&lt;-</span> <span class="st">"../../Data/TraCE21ka/"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="defining-parameters-for-downscaling">Defining parameters for downscaling<a class="anchor" aria-label="anchor" href="#defining-parameters-for-downscaling"></a>
</h3>
<p>The following code is setting up parameters for the R package
<code>downscaleR</code>. The <code>spatial.pars</code> list is defining
the variables that should be combined using a Principal Component
Analysis. Here, we specify all predictor variables. Hence, those models
using spatial.pars argument will use all the variables to fit a PCA and
transform the varibles. More especifically, the PCA will retain those
axis that explain up to 90% of the variance (<code>v.exp</code>) and
will not be rotated. The <code>local.pars.XXX</code> objects define
different configurations of local vars for the models. <code>M2</code>
models use the only one variable as the local variable, whereas
<code>M3</code> uses all predictor variables as local variables.
Finally, models ending in 1 use the information of the local pixel as
predictor, whereas models ending in 4 use the information from the 4
closest pixels as predictors.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.meteo.unican.es/climate4r" class="external-link">downscaleR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">spatial.pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  which.combine <span class="op">=</span> <span class="va">vars</span>,</span>
<span>  v.exp <span class="op">=</span> <span class="fl">.95</span>,</span>
<span>  rot <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">local.pars.M21</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, vars <span class="op">=</span> <span class="va">local.var</span><span class="op">)</span></span>
<span></span>
<span><span class="va">local.pars.M24</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span>, vars <span class="op">=</span> <span class="va">local.var</span><span class="op">)</span></span>
<span></span>
<span><span class="va">local.pars.M31</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, vars <span class="op">=</span> <span class="va">vars</span><span class="op">)</span></span>
<span></span>
<span><span class="va">local.pars.M34</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span>, vars <span class="op">=</span> <span class="va">vars</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-loading">Data loading<a class="anchor" aria-label="anchor" href="#data-loading"></a>
</h3>
<p>To load the data, we retrieve file names from all files in the trace
directory. The first line assigns the trace file names from the trace
directory to the variable “trace.file.names”. Then, we loads the trace
files into the variable “hist.trace” and specifies the years 1961-1990,
since we are not intended to downscale the whole period but only the
historical period to run the crossvalidation. The following lines check
that the data were loaded properly.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trace.file.names</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/traceFileNames.html">traceFileNames</a></span><span class="op">(</span><span class="va">trace.dir</span><span class="op">)</span></span>
<span><span class="va">hist.trace</span> <span class="op">&lt;-</span> <span class="fu">dsclim</span><span class="fu">::</span><span class="fu"><a href="../reference/loadTrace.html">loadTrace</a></span><span class="op">(</span><span class="va">trace.file.names</span>, years <span class="op">=</span> <span class="fl">1961</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span></span>
<span><span class="va">hist.trace</span><span class="op">$</span><span class="va">Variable</span><span class="op">$</span><span class="va">varName</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hist.trace</span><span class="op">$</span><span class="va">Dates</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">start</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">hist.trace</span><span class="op">$</span><span class="va">Dates</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">start</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hist.trace</span><span class="op">$</span><span class="va">Dates</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">end</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">hist.trace</span><span class="op">$</span><span class="va">Dates</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">end</span><span class="op">)</span></span></code></pre></div>
<p>Now, we need to load the data from the UERRA project since this is
going to be our current high resolution climate data to be used as
predictand. The first line is loading the local variable
(<code>local.var</code>) from the
<code>2m_temperature/latlon/1961-90_2m_tmin.nc</code> file in the
UERRA-HARMONIE directory and and assigning it to the variable
<code>uerra.data</code>. The following lines just check that data were
loaded properly and matches the same dates than loaded TraCE21ka
data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uerra.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loadUerra.html">loadUerra</a></span><span class="op">(</span><span class="st">"../../Data/UERRA/UERRA-HARMONIE/2m_temperature/latlon/1961-90_2m_tmin.nc"</span>, <span class="va">local.var</span><span class="op">)</span></span>
<span><span class="va">uerra.data</span><span class="op">$</span><span class="va">Variable</span><span class="op">$</span><span class="va">varName</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">uerra.data</span><span class="op">$</span><span class="va">Dates</span><span class="op">$</span><span class="va">start</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">uerra.data</span><span class="op">$</span><span class="va">Dates</span><span class="op">$</span><span class="va">end</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">uerra.data</span><span class="op">$</span><span class="va">Dates</span><span class="op">$</span><span class="va">end</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">uerra.data</span><span class="op">$</span><span class="va">Dates</span><span class="op">$</span><span class="va">end</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3 tabset tabset-pills">
<h3 class="tabset tabset-pills" id="downscaling-1">Downscaling<a class="anchor" aria-label="anchor" href="#downscaling-1"></a>
</h3>
<p>Now, we can start fitting models with the cross validation
approach.</p>
<p>In general, the code uses the <code>downscaleR</code> package to fit
a Generalized Linear Model (GLM) downscaling method to create a model
that predicts paleoclimate data from historical climate. The
<code>family</code> argument sets the distribution of the model to a
Gaussian distribution with an <code>identity</code> link. The
<code>folds</code> argument sets the number of folds to use in the
cross-validation. The <code>prepareData.args</code> is a list of
arguments that sets the global, local, and spatial predictors to use in
the model.</p>
<p>The result from the downscaling is a high resolution dataset for the
whole period (1961-1990), although the data for group of five years were
not used to fit the particular model used to dowscale this five years
data. Finally, we use the <code>spatialPlot</code> function from the
<code>visualizeR</code> package to plot an average of the output (e.g. a
<code>climatology</code> calculated with the <code>transformeR</code>
package).</p>
<p>To see the code for each model, select a tab:</p>







<ul class="nav nav-pills" id="downscaling-1" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#glm-1-sp" id="glm-1-sp-tab" type="button" role="tab" aria-controls="glm-1-sp" aria-selected="true" class="active nav-link">GLM.1.sp</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#glm-21" id="glm-21-tab" type="button" role="tab" aria-controls="glm-21" aria-selected="false" class="nav-link">GLM.21</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#glm-21-sp" id="glm-21-sp-tab" type="button" role="tab" aria-controls="glm-21-sp" aria-selected="false" class="nav-link">GLM.21.sp</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#glm-24" id="glm-24-tab" type="button" role="tab" aria-controls="glm-24" aria-selected="false" class="nav-link">GLM.24</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#glm-24-sp" id="glm-24-sp-tab" type="button" role="tab" aria-controls="glm-24-sp" aria-selected="false" class="nav-link">GLM.24.sp</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#glm-31" id="glm-31-tab" type="button" role="tab" aria-controls="glm-31" aria-selected="false" class="nav-link">GLM.31</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#glm-34" id="glm-34-tab" type="button" role="tab" aria-controls="glm-34" aria-selected="false" class="nav-link">GLM.34</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="glm-1-sp" role="tabpanel" aria-labelledby="glm-1-sp-tab">

<p>This model uses spatial pars but do not use global or local
variables.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GLM.1.sp</span> <span class="op">&lt;-</span> <span class="fu">downscaleR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/downscaleR/man/downscaleCV.html" class="external-link">downscaleCV</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">hist.trace</span>,</span>
<span>  y <span class="op">=</span> <span class="va">uerra.data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"GLM"</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  folds <span class="op">=</span> <span class="va">folds</span>,</span>
<span>  prepareData.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    global.vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    local.predictors <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    spatial.predictors <span class="op">=</span> <span class="va">spatial.pars</span>,</span>
<span>    combined.only <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">visualizeR</span><span class="fu">::</span><span class="fu">spatialPlot</span><span class="op">(</span><span class="fu">transformeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/transformeR/man/climatology.html" class="external-link">climatology</a></span><span class="op">(</span><span class="va">GLM.1.sp</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_cv_glm1sp_tasmin.png" alt="Downscaled minimum temperature from TraCE21ka for the period 1960-90 using UERRA for the same period and GLM.1.sp downscaling specifications."><div class="figcaption">Downscaled minimum temperature from TraCE21ka
for the period 1960-90 using UERRA for the same period and GLM.1.sp
downscaling specifications.</div>
</div>
</div>
<div class="tab-pane" id="glm-21" role="tabpanel" aria-labelledby="glm-21-tab">

<p>This model uses a local variables with 1 local pixel, but no spatial
or global variables.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GLM.21</span> <span class="op">&lt;-</span> <span class="fu">downscaleR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/downscaleR/man/downscaleCV.html" class="external-link">downscaleCV</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">hist.trace</span>,</span>
<span>  y <span class="op">=</span> <span class="va">uerra.data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"GLM"</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  folds <span class="op">=</span> <span class="va">folds</span>,</span>
<span>  prepareData.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    global.vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    local.predictors <span class="op">=</span> <span class="va">local.pars.M21</span>,</span>
<span>    spatial.predictors <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">visualizeR</span><span class="fu">::</span><span class="fu">spatialPlot</span><span class="op">(</span><span class="fu">transformeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/transformeR/man/climatology.html" class="external-link">climatology</a></span><span class="op">(</span><span class="va">GLM.21</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_cv_glm21_tasmin.png" alt="Downscaled minimum temperature from TraCE21ka for the period 1960-90 using UERRA for the same period and GLM.21 downscaling specifications."><div class="figcaption">Downscaled minimum temperature from TraCE21ka
for the period 1960-90 using UERRA for the same period and GLM.21
downscaling specifications.</div>
</div>
</div>
<div class="tab-pane" id="glm-21-sp" role="tabpanel" aria-labelledby="glm-21-sp-tab">

<p>This model uses a local variables with 1 local pixel and spatial
variables, but no global variables.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GLM.21.sp</span> <span class="op">&lt;-</span> <span class="fu">downscaleR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/downscaleR/man/downscaleCV.html" class="external-link">downscaleCV</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">hist.trace</span>,</span>
<span>  y <span class="op">=</span> <span class="va">uerra.data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"GLM"</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  folds <span class="op">=</span> <span class="va">folds</span>,</span>
<span>  prepareData.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    global.vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    local.predictors <span class="op">=</span> <span class="va">local.pars.M21</span>,</span>
<span>    spatial.predictors <span class="op">=</span> <span class="va">spatial.pars</span>,</span>
<span>    combined.only <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">visualizeR</span><span class="fu">::</span><span class="fu">spatialPlot</span><span class="op">(</span><span class="fu">transformeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/transformeR/man/climatology.html" class="external-link">climatology</a></span><span class="op">(</span><span class="va">GLM.21.sp</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_cv_glm21sp_tasmin.png" alt="Downscaled minimum temperature from TraCE21ka for the period 1960-90 using UERRA for the same period and GLM.21.sp downscaling specifications."><div class="figcaption">Downscaled minimum temperature from TraCE21ka
for the period 1960-90 using UERRA for the same period and GLM.21.sp
downscaling specifications.</div>
</div>
</div>
<div class="tab-pane" id="glm-24" role="tabpanel" aria-labelledby="glm-24-tab">

<p>This model uses a local variables with 4 local pixel, but no spatial
or global variables.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GLM.24</span> <span class="op">&lt;-</span> <span class="fu">downscaleR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/downscaleR/man/downscaleCV.html" class="external-link">downscaleCV</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">hist.trace</span>,</span>
<span>  y <span class="op">=</span> <span class="va">uerra.data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"GLM"</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  folds <span class="op">=</span> <span class="va">folds</span>,</span>
<span>  prepareData.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    global.vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    local.predictors <span class="op">=</span> <span class="va">local.pars.M24</span>,</span>
<span>    spatial.predictors <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">visualizeR</span><span class="fu">::</span><span class="fu">spatialPlot</span><span class="op">(</span><span class="fu">transformeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/transformeR/man/climatology.html" class="external-link">climatology</a></span><span class="op">(</span><span class="va">GLM.24</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_cv_glm24_tasmin.png" alt="Downscaled minimum temperature from TraCE21ka for the period 1960-90 using UERRA for the same period and GLM.24 downscaling specifications."><div class="figcaption">Downscaled minimum temperature from TraCE21ka
for the period 1960-90 using UERRA for the same period and GLM.24
downscaling specifications.</div>
</div>
</div>
<div class="tab-pane" id="glm-24-sp" role="tabpanel" aria-labelledby="glm-24-sp-tab">

<p>This model uses a local variables with 4 local pixel and spatial
variables, but no global variables.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GLM.24.sp</span> <span class="op">&lt;-</span> <span class="fu">downscaleR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/downscaleR/man/downscaleCV.html" class="external-link">downscaleCV</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">hist.trace</span>,</span>
<span>  y <span class="op">=</span> <span class="va">uerra.data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"GLM"</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  folds <span class="op">=</span> <span class="va">folds</span>,</span>
<span>  prepareData.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    global.vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    local.predictors <span class="op">=</span> <span class="va">local.pars.M24</span>,</span>
<span>    spatial.predictors <span class="op">=</span> <span class="va">spatial.pars</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">visualizeR</span><span class="fu">::</span><span class="fu">spatialPlot</span><span class="op">(</span><span class="fu">transformeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/transformeR/man/climatology.html" class="external-link">climatology</a></span><span class="op">(</span><span class="va">GLM.24.sp</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_cv_glm24sp_tasmin.png" alt="Downscaled minimum temperature from TraCE21ka for the period 1960-90 using UERRA for the same period and GLM.24.sp downscaling specifications."><div class="figcaption">Downscaled minimum temperature from TraCE21ka
for the period 1960-90 using UERRA for the same period and GLM.24.sp
downscaling specifications.</div>
</div>
</div>
<div class="tab-pane" id="glm-31" role="tabpanel" aria-labelledby="glm-31-tab">

<p>This model uses all variables as local variables with 1 local pixel,
but no spatial or global variables.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GLM.31</span> <span class="op">&lt;-</span> <span class="fu">downscaleR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/downscaleR/man/downscaleCV.html" class="external-link">downscaleCV</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">hist.trace</span>,</span>
<span>  y <span class="op">=</span> <span class="va">uerra.data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"GLM"</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  folds <span class="op">=</span> <span class="va">folds</span>,</span>
<span>  prepareData.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    global.vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    local.predictors <span class="op">=</span> <span class="va">local.pars.M31</span>,</span>
<span>    spatial.predictors <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">visualizeR</span><span class="fu">::</span><span class="fu">spatialPlot</span><span class="op">(</span><span class="fu">transformeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/transformeR/man/climatology.html" class="external-link">climatology</a></span><span class="op">(</span><span class="va">GLM.31</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_cv_glm31_tasmin.png" alt="Downscaled minimum temperature from TraCE21ka for the period 1960-90 using UERRA for the same period and GLM.31 downscaling specifications."><div class="figcaption">Downscaled minimum temperature from TraCE21ka
for the period 1960-90 using UERRA for the same period and GLM.31
downscaling specifications.</div>
</div>
</div>
<div class="tab-pane" id="glm-34" role="tabpanel" aria-labelledby="glm-34-tab">

<p>This model uses all variables as local variables with 4 local pixel,
but no spatial or global variables.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GLM.34</span> <span class="op">&lt;-</span> <span class="fu">downscaleR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/downscaleR/man/downscaleCV.html" class="external-link">downscaleCV</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">hist.trace</span>,</span>
<span>  y <span class="op">=</span> <span class="va">uerra.data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"GLM"</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  folds <span class="op">=</span> <span class="va">folds</span>,</span>
<span>  prepareData.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    global.vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    local.predictors <span class="op">=</span> <span class="va">local.pars.M34</span>,</span>
<span>    spatial.predictors <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">visualizeR</span><span class="fu">::</span><span class="fu">spatialPlot</span><span class="op">(</span><span class="fu">transformeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/transformeR/man/climatology.html" class="external-link">climatology</a></span><span class="op">(</span><span class="va">GLM.34</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_cv_glm34_tasmin.png" alt="Downscaled minimum temperature from TraCE21ka for the period 1961-90 using UERRA for the same period and GLM.34 downscaling specifications."><div class="figcaption">Downscaled minimum temperature from TraCE21ka
for the period 1961-90 using UERRA for the same period and GLM.34
downscaling specifications.</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="evaluate-downscaling-performance">Evaluate downscaling performance<a class="anchor" aria-label="anchor" href="#evaluate-downscaling-performance"></a>
</h2>
<p>Now that we have a downscaled version of the data, we can evaluate
their values against the “real” data, represented here by the UERRA
dataset.</p>
<div class="section level3">
<h3 id="create-function-to-extract-info">Create function to extract info<a class="anchor" aria-label="anchor" href="#create-function-to-extract-info"></a>
</h3>
<p>First, we define a function that will run the evaluation and extract
significant metrics.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_validation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">models</span>, <span class="va">obs</span>, <span class="va">measure.code</span> <span class="op">=</span> <span class="st">"bias"</span>, <span class="va">index.code</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>    <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span></span>
<span>        <span class="fu">climate4R.value</span><span class="fu">::</span><span class="fu">valueMeasure</span><span class="op">(</span></span>
<span>          <span class="va">obs</span>,</span>
<span>          x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">models</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,</span>
<span>          measure.code <span class="op">=</span> <span class="va">measure.code</span>,</span>
<span>          index.code <span class="op">=</span> <span class="va">index.code</span></span>
<span>        <span class="op">)</span><span class="op">$</span><span class="va">Measure</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">l</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">models</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">l</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-evaluation">Run evaluation<a class="anchor" aria-label="anchor" href="#run-evaluation"></a>
</h3>
<p>Then, we can use this function to evaluate all the models. To speed
things up, we run this code in several cores of the computer using the
<code>parallel</code> package.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds.methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GLM.1.sp"</span>, <span class="st">"GLM.21"</span>, <span class="st">"GLM.21.sp"</span>, <span class="st">"GLM.24"</span>, <span class="st">"GLM.24.sp"</span>, <span class="st">"GLM.31"</span>, <span class="st">"GLM.34"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">value.indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mean"</span>, <span class="st">"sd"</span>, <span class="st">"Skewness"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterExport</a></span><span class="op">(</span><span class="va">cl</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ds_validation"</span>, <span class="va">ds.methods</span>, <span class="st">"uerra.data"</span>, <span class="st">"value.indices"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">val.results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parLapply</a></span><span class="op">(</span></span>
<span>  <span class="va">cl</span>,</span>
<span>  <span class="va">value.indices</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">j</span>, <span class="va">k</span>, <span class="va">l</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">ds_validation</span><span class="op">(</span></span>
<span>      models <span class="op">=</span> <span class="va">j</span>,</span>
<span>      obs <span class="op">=</span> <span class="va">k</span>,</span>
<span>      measure.code <span class="op">=</span> <span class="va">l</span>,</span>
<span>      index.code <span class="op">=</span> <span class="va">i</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  <span class="va">ds.methods</span>,</span>
<span>  <span class="va">uerra.data</span>,</span>
<span>  <span class="st">"bias"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">val.results</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value.indices</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="plot-evaluations-results">Plot evaluations’ results<a class="anchor" aria-label="anchor" href="#plot-evaluations-results"></a>
</h2>
<p>Finally, we can plot the results from the evaluations in several
formats.</p>
<div class="section level3 tabset tabset-pills">
<h3 class="tabset tabset-pills" id="error-or-bias-maps">Error (or bias) maps<a class="anchor" aria-label="anchor" href="#error-or-bias-maps"></a>
</h3>
<p>First, we plot mean bias in each pixel (the mean include 30 years *
12 months data). To see the maps from each model select a tab:</p>







<ul class="nav nav-pills" id="error-or-bias-maps" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#glm-1-sp-1" id="glm-1-sp-1-tab" type="button" role="tab" aria-controls="glm-1-sp-1" aria-selected="true" class="active nav-link">GLM.1.sp</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#glm-21-1" id="glm-21-1-tab" type="button" role="tab" aria-controls="glm-21-1" aria-selected="false" class="nav-link">GLM.21</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#glm-21-sp-1" id="glm-21-sp-1-tab" type="button" role="tab" aria-controls="glm-21-sp-1" aria-selected="false" class="nav-link">GLM.21.sp</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#glm-24-1" id="glm-24-1-tab" type="button" role="tab" aria-controls="glm-24-1" aria-selected="false" class="nav-link">GLM.24</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#glm-24-sp-1" id="glm-24-sp-1-tab" type="button" role="tab" aria-controls="glm-24-sp-1" aria-selected="false" class="nav-link">GLM.24.sp</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#glm-31-1" id="glm-31-1-tab" type="button" role="tab" aria-controls="glm-31-1" aria-selected="false" class="nav-link">GLM.31</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#glm-34-1" id="glm-34-1-tab" type="button" role="tab" aria-controls="glm-34-1" aria-selected="false" class="nav-link">GLM.34</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="glm-1-sp-1" role="tabpanel" aria-labelledby="glm-1-sp-1-tab">

<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">visualizeR</span><span class="fu">::</span><span class="fu">spatialPlot</span><span class="op">(</span><span class="va">val.results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  backdrop.theme <span class="op">=</span> <span class="st">"countries"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"GLM.1.sp - bias mean"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_bias_glm1sp_tasmin.png" alt="Bias map from GLM.1.sp downscaled model"><div class="figcaption">Bias map from GLM.1.sp downscaled model</div>
</div>
</div>
<div class="tab-pane" id="glm-21-1" role="tabpanel" aria-labelledby="glm-21-1-tab">

<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">visualizeR</span><span class="fu">::</span><span class="fu">spatialPlot</span><span class="op">(</span><span class="va">val.results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  backdrop.theme <span class="op">=</span> <span class="st">"countries"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"GLM.21 - bias mean"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_bias_glm21_tasmin.png" alt="Bias map from GLM.21 downscaled model"><div class="figcaption">Bias map from GLM.21 downscaled model</div>
</div>
</div>
<div class="tab-pane" id="glm-21-sp-1" role="tabpanel" aria-labelledby="glm-21-sp-1-tab">

<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">visualizeR</span><span class="fu">::</span><span class="fu">spatialPlot</span><span class="op">(</span><span class="va">val.results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  backdrop.theme <span class="op">=</span> <span class="st">"countries"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"GLM.21.sp - bias mean"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_bias_glm21sp_tasmin.png" alt="Bias map from GLM.21.sp downscaled model"><div class="figcaption">Bias map from GLM.21.sp downscaled model</div>
</div>
</div>
<div class="tab-pane" id="glm-24-1" role="tabpanel" aria-labelledby="glm-24-1-tab">

<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">visualizeR</span><span class="fu">::</span><span class="fu">spatialPlot</span><span class="op">(</span><span class="va">val.results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  backdrop.theme <span class="op">=</span> <span class="st">"countries"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"GLM.24 - bias mean"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_bias_glm24_tasmin.png" alt="Bias map from GLM.24 downscaled model"><div class="figcaption">Bias map from GLM.24 downscaled model</div>
</div>
</div>
<div class="tab-pane" id="glm-24-sp-1" role="tabpanel" aria-labelledby="glm-24-sp-1-tab">

<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">visualizeR</span><span class="fu">::</span><span class="fu">spatialPlot</span><span class="op">(</span><span class="va">val.results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  backdrop.theme <span class="op">=</span> <span class="st">"countries"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"GLM.24.sp - bias mean"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_bias_glm24sp_tasmin.png" alt="Bias map from GLM.24.sp downscaled model"><div class="figcaption">Bias map from GLM.24.sp downscaled model</div>
</div>
</div>
<div class="tab-pane" id="glm-31-1" role="tabpanel" aria-labelledby="glm-31-1-tab">

<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">visualizeR</span><span class="fu">::</span><span class="fu">spatialPlot</span><span class="op">(</span><span class="va">val.results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  backdrop.theme <span class="op">=</span> <span class="st">"countries"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"GLM.31 - bias mean"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_bias_glm31_tasmin.png" alt="Bias map from GLM.31 downscaled model"><div class="figcaption">Bias map from GLM.31 downscaled model</div>
</div>
</div>
<div class="tab-pane" id="glm-34-1" role="tabpanel" aria-labelledby="glm-34-1-tab">

<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">visualizeR</span><span class="fu">::</span><span class="fu">spatialPlot</span><span class="op">(</span><span class="va">val.results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  backdrop.theme <span class="op">=</span> <span class="st">"countries"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"GLM.34 - bias mean"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_bias_glm34_tasmin.png" alt="Bias map from GLM.34 downscaled model"><div class="figcaption">Bias map from GLM.34 downscaled model</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="violin-plots-sumarizing-results">Violin plots sumarizing results<a class="anchor" aria-label="anchor" href="#violin-plots-sumarizing-results"></a>
</h3>
<p>To have an overall perspective of all the metrics from the different
models, we can use violin plots for each model and the three metrics of
the bias (mean, sd, and skewness).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">getGridData</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">grid</span><span class="op">)</span> <span class="va">grid</span><span class="op">$</span><span class="va">Data</span></span>
<span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">val.results</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">getGridData</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu">melt</span><span class="op">(</span><span class="va">test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test</span><span class="op">$</span><span class="va">mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html" class="external-link">ave</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">value</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">L1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">L2</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test</span><span class="op">$</span><span class="va">L2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">L2</span>, levels <span class="op">=</span> <span class="va">ds.methods</span><span class="op">)</span></span>
<span><span class="va">test</span><span class="op">$</span><span class="va">L1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">L1</span>, levels <span class="op">=</span> <span class="va">value.indices</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">test</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">L2</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_violin</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">L1</span> <span class="op">~</span> <span class="va">.</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_val_summary_violin.png" alt="Bias summary"><div class="figcaption">Bias summary</div>
</div>
</div>
<div class="section level3">
<h3 id="error-or-bias-histograms">Error or bias histograms<a class="anchor" aria-label="anchor" href="#error-or-bias-histograms"></a>
</h3>
<p>Finally, we complement previous evaluations ploting the histograms
from each metric.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.meteo.unican.es/climate4r" class="external-link">transformeR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/transformeR/man/scaleGrid.html" class="external-link">scaleGrid</a></span><span class="op">(</span><span class="va">GLM.1.sp</span>, <span class="va">uerra.data</span><span class="op">)</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/transformeR/man/scaleGrid.html" class="external-link">scaleGrid</a></span><span class="op">(</span><span class="va">GLM.21</span>, <span class="va">uerra.data</span><span class="op">)</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/transformeR/man/scaleGrid.html" class="external-link">scaleGrid</a></span><span class="op">(</span><span class="va">GLM.21.sp</span>, <span class="va">uerra.data</span><span class="op">)</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/transformeR/man/scaleGrid.html" class="external-link">scaleGrid</a></span><span class="op">(</span><span class="va">GLM.24</span>, <span class="va">uerra.data</span><span class="op">)</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/transformeR/man/scaleGrid.html" class="external-link">scaleGrid</a></span><span class="op">(</span><span class="va">GLM.24.sp</span>, <span class="va">uerra.data</span><span class="op">)</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/transformeR/man/scaleGrid.html" class="external-link">scaleGrid</a></span><span class="op">(</span><span class="va">GLM.31</span>, <span class="va">uerra.data</span><span class="op">)</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/transformeR/man/scaleGrid.html" class="external-link">scaleGrid</a></span><span class="op">(</span><span class="va">GLM.34</span>, <span class="va">uerra.data</span><span class="op">)</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa3%2Fa3_val_summary_histograms.png" width="500" height="500" alt="Bias summary histograms"><div class="figcaption">Bias summary histograms</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Diego Nieto-Lugilde, Daniel Romera-Romera.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
