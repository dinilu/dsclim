<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>4. Downscaling climate data • dsclim</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="4. Downscaling climate data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dsclim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a1_Data_downloading_and_preprocessing.html">1. Data downloading and preprocessing</a></li>
    <li><a class="dropdown-item" href="../articles/a2_Load_source_data.html">2. Load source data</a></li>
    <li><a class="dropdown-item" href="../articles/a3_Downscale_with_Cross-validation.html">3. Downscaling with crossvalidation</a></li>
    <li><a class="dropdown-item" href="../articles/a4_Downscale_climate_data.html">4. Downscaling climate data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dinilu/dsclim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>4. Downscaling climate data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dinilu/dsclim/blob/v0.0.900/vignettes/a4_Downscale_climate_data.Rmd" class="external-link"><code>vignettes/a4_Downscale_climate_data.Rmd</code></a></small>
      <div class="d-none name"><code>a4_Downscale_climate_data.Rmd</code></div>
    </div>

    
    
<p>This file is to document the downscaling process of TraCE21ka
paleoclimate and CMIP5 future climate simulations data using the most
updated and finer resolution “historical” climate data for the Western
Mediterranean region and the methods and tools implemented in the
<code>climate4R</code> framework.</p>
<div class="section level2">
<h2 id="defining-common-parameters">Defining common parameters<a class="anchor" aria-label="anchor" href="#defining-common-parameters"></a>
</h2>
<div class="section level3">
<h3 id="defining-variables-and-folds-for-crossvalidation">Defining variables and folds for crossvalidation<a class="anchor" aria-label="anchor" href="#defining-variables-and-folds-for-crossvalidation"></a>
</h3>
<p>This code is setting up the parameters for a downscaling process in
the <code>dsclim</code> library. The <code>vars</code> variable is
setting up the variables that will be included in the dataset. The
<code>spatial.pars</code> variable is setting up the parameters of the
spatial combination. The <code>family.link</code> variable is setting
the link function for the Generalized Linear Model used as transfer
model in the downscaling process. Lastly, the
<code>global.nc.attributes</code> variable is setting the author,
institution, and email of the responsible of the downscaled dataset.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dinilu/dsclim" class="external-link">dsclim</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> </span>
<span>  <span class="st">"tas"</span>, <span class="st">"tasmin"</span>, <span class="st">"tasmax"</span>, <span class="st">"hurs@992.5561"</span>, <span class="st">"ps"</span>,</span>
<span>  <span class="st">"pr"</span>, <span class="st">"cld"</span>, <span class="st">"wss"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">spatial.pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> </span>
<span>  which.combine <span class="op">=</span> <span class="va">vars</span>,</span>
<span>  v.exp <span class="op">=</span> <span class="fl">.7</span>,</span>
<span>  rot <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">family.link</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">global.nc.attributes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"author"</span> <span class="op">=</span> <span class="st">"Diego Nieto Lugilde &amp; Daniel Romera Romera"</span>, <span class="st">"institution"</span> <span class="op">=</span> <span class="st">"Universidad de Cordoba"</span>, <span class="st">"email"</span> <span class="op">=</span> <span class="st">"bv2nilud@uco.es"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="loading-uerra-data">Loading UERRA data<a class="anchor" aria-label="anchor" href="#loading-uerra-data"></a>
</h3>
<p>Next, we loads the UERRA (Unified European Reanalysis) data for 2m
temperature variable, “tas”, from the
“../../Data/UERRA/UERRA-HARMONIE/2m_temperature/latlon/1961-90_2m_temperature.nc”
file. The data is then stored in an object called “uerra”.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uerra</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loadUerra.html">loadUerra</a></span><span class="op">(</span><span class="st">"../../Data/UERRA/UERRA-HARMONIE/2m_temperature/latlon/1961-90_2m_temperature.nc"</span>, <span class="st">"tas"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="downscale-trace21ka-data">Downscale TraCE21ka data<a class="anchor" aria-label="anchor" href="#downscale-trace21ka-data"></a>
</h2>
<div class="section level3">
<h3 id="loading-trace21ka-data">Loading TraCE21ka data<a class="anchor" aria-label="anchor" href="#loading-trace21ka-data"></a>
</h3>
<p>This R code is loading TraCE21ka data from the directory
“../../Data/TraCE21ka/”. The first line of code assigns the variable
“trace.file.names” to a list of the trace file names in the given
directory. The second line of code assigns the variable “hist.trace” to
the trace data loaded from the trace file names over the years 1961 to
1990.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trace.file.names</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/traceFileNames.html">traceFileNames</a></span><span class="op">(</span><span class="st">"../../Data/TraCE21ka/"</span><span class="op">)</span></span>
<span><span class="va">hist.trace</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loadTrace.html">loadTrace</a></span><span class="op">(</span><span class="va">trace.file.names</span>, years <span class="op">=</span> <span class="fl">1961</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prepare-data-for-downscaling">Prepare data for downscaling<a class="anchor" aria-label="anchor" href="#prepare-data-for-downscaling"></a>
</h3>
<p>Now, the following code uses the downscaleR R package to prepare data
for downscaling. The prepareData function takes two arguments:
hist.trace and uerra. The hist.trace argument is a historical TraCE21ka
data that will be used as predictors for downscaling, and the uerra
argument is the set of UERRA data containing regional climate model
output (used as predictand). The third argument, spatial.predictors,
contains the spatial parameters that will be used to predict the
downscaled data. The data object is then populated with the prepared
data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">downscaleR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/downscaleR/man/prepareData.html" class="external-link">prepareData</a></span><span class="op">(</span><span class="va">hist.trace</span>, <span class="va">uerra</span>, spatial.predictors <span class="op">=</span> <span class="va">spatial.pars</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="train-downscaling-model">Train downscaling model<a class="anchor" aria-label="anchor" href="#train-downscaling-model"></a>
</h3>
<p>This code is using the downscaleR R package to train a model. The
model is based on a Generalized Linear Model (GLM) with a specified
family link (family.link = gaussian(link = “identity”)). Model
prediction for the training data will be calculated and stored in the
model object (predict = TRUE).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">downscaleR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/downscaleR/man/downscaleTrain.html" class="external-link">downscaleTrain</a></span><span class="op">(</span><span class="va">data</span>, method <span class="op">=</span> <span class="st">"GLM"</span>, family <span class="op">=</span> <span class="va">family.link</span>, predict <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="downscale-a-single-trace21ka-file">Downscale a single TraCE21ka file<a class="anchor" aria-label="anchor" href="#downscale-a-single-trace21ka-file"></a>
</h3>
<p>The next R code downscale a single trace file using the
“downscaleTrace” function from the <code>dsclim</code> package. The
first argument (4) is the number of the trace file to be downscaled, and
the second and third arguments are the directory paths of the original
trace file and the output directory, respectively. The fourth argument,
“mod_data” refers to the input data used to downscale the trace file,
while the fifth argument, “model”, specifies the model used for the
downscaling process. The last argument, “global_nc_attributes”, refers
to the global attributes associated with the trace file, which are
required for the downscaling process. Note that the result of the
function is not saved as an R object in the environment but a series of
downscaled files that are saved in the output directory
(“output/TraCE21ka/”).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/downscaleTrace.html">downscaleTrace</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"../../Data/TraCE21ka/"</span>, <span class="st">"output/TraCE21ka/"</span>, mod_data <span class="op">=</span> <span class="va">data</span>, model <span class="op">=</span> <span class="va">model</span>, global_nc_attributes <span class="op">=</span> <span class="va">global.nc.attributes</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="downscale-all-trace21ka-files-for-a-single-variable">Downscale all TraCE21ka files for a single variable<a class="anchor" aria-label="anchor" href="#downscale-all-trace21ka-files-for-a-single-variable"></a>
</h3>
<p>Similarly, we can use the <code>lapply</code> function to call the
<code>downscaleTrace</code> function on a list of values (1:36). This
will downscale each trace file in the specified directory
(“../../Data/TraCE21ka/”) and write the result in the output directory
(“output/TraCE21ka”). The downscaleTrace function also has the
parameters hist_trace, mod_data, model, and global_nc_attributes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">36</span>, <span class="va">downscaleTrace</span>, <span class="st">"../../Data/TraCE21ka/"</span>, <span class="st">"output/TraCE21ka"</span>, hist_trace <span class="op">=</span> <span class="va">hist.trace</span>, mod_data <span class="op">=</span> <span class="va">data</span>, model <span class="op">=</span> <span class="va">model</span>, global_nc_attributes <span class="op">=</span> <span class="va">global.nc.attributes</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="downscale-cmip5-data">Downscale CMIP5 data<a class="anchor" aria-label="anchor" href="#downscale-cmip5-data"></a>
</h2>
<div class="section level3">
<h3 id="defining-specific-arguments">Defining specific arguments<a class="anchor" aria-label="anchor" href="#defining-specific-arguments"></a>
</h3>
<p>Now, we create a data frame with all combinations of the cmip5.rcps
and cmip5.mods variables. These variables are “rcp2.6”, “rcp4.5”,
“rcp6.0” and “rcp8.5” for cmip5.rcps, and “CESM1-CAM5”, “CSIRO-Mk3-6-0”
and “IPSL-CM5A-MR” for cmip5.mods. The data frame will contain all of
the possible combinations of these two variables. Here, we also create a
“vars” variable with the name of all the CMIP5 variables names to be
used afterwards.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmip5.rcps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rcp2.6"</span>, <span class="st">"rcp4.5"</span>, <span class="st">"rcp6.0"</span>, <span class="st">"rcp8.5"</span><span class="op">)</span></span>
<span><span class="va">cmip5.mods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CESM1-CAM5"</span>, <span class="st">"CSIRO-Mk3-6-0"</span>, <span class="st">"IPSL-CM5A-MR"</span><span class="op">)</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tas"</span>, <span class="st">"tasmax"</span>, <span class="st">"tasmin"</span>, <span class="st">"hurs"</span>, <span class="st">"ps"</span>, <span class="st">"pr"</span>, <span class="st">"cld"</span>, <span class="st">"wss"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="va">cmip5.rcps</span>, <span class="va">cmip5.mods</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="downscaling-cmip5-data-for-a-single-combination-of-rcps-and-climate-model">Downscaling CMIP5 data for a single combination of RCPs and climate
model<a class="anchor" aria-label="anchor" href="#downscaling-cmip5-data-for-a-single-combination-of-rcps-and-climate-model"></a>
</h3>
<p>This R code downscale a single RCP from the CMIP5 dataset. The
<code>downscaleCMIP5</code> function takes 5 parameters:
cmip5.rcps[[1]], cmip5.mods[[1]], indir, uerra, outdir and method. The
first two parameters are the RCP and GCM to downscale, respectively. The
indir parameter is the directory where the CMIP5 data is located. The
uerra parameter is used to specify UERRA dataset (predictand) in the
downscaling process. The outdir parameter is the directory where the
downscaled data should be saved. The method parameter specifies the
downscaling method to use, which in this case is the GLM (generalized
linear model) method. The family_link and spatial_pars parameters are
used to specify the family link and spatial parameters for the GLM
model. Finally, the global_nc_attributes parameter is used to specify
global attributes for the output NetCDF files.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/downscaleCMIP5.html">downscaleCMIP5</a></span><span class="op">(</span><span class="va">cmip5.rcps</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">cmip5.mods</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, indir <span class="op">=</span> <span class="st">"../../Data/CMIP5/"</span>, <span class="va">uerra</span>, outdir <span class="op">=</span> <span class="st">"output/CMIP5/"</span>, method <span class="op">=</span> <span class="st">"GLM"</span>, family_link <span class="op">=</span> <span class="st">"gaussian"</span>, spatial_pars <span class="op">=</span> <span class="va">spatial.pars</span>, global_nc_attributes <span class="op">=</span> <span class="va">global.nc.attributes</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="downscaling-cmip5-data-for-all-combination-of-rcps-and-climate-models">Downscaling CMIP5 data for all combination of RCPs and climate
models<a class="anchor" aria-label="anchor" href="#downscaling-cmip5-data-for-all-combination-of-rcps-and-climate-models"></a>
</h3>
<p>Finally, we downscale climate data from all RCPs and GCMs in the
CMIP5 dataset by using the <code>mapply</code> function to apply the
<code>downscaleCMIP5</code> function to all RCPs and GCMs values (stored
in the Var1 and Var2 columns of the df data frame). The
<code>downscaleCMIP5</code> function takes other parameters that include
the indir directory (“../../Data/CMIP5/”), the UERRA data (uerra), the
outdir directory (“output/CMIP5/”), the method used (“GLM”), the
family_link (gaussian), the spatial_pars variable, and the
global_nc_attributes variable.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">downscaleCMIP5</span>, <span class="va">df</span><span class="op">$</span><span class="va">Var1</span>, <span class="va">df</span><span class="op">$</span><span class="va">Var2</span>, MoreArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>indir <span class="op">=</span> <span class="st">"../../Data/CMIP5/"</span>, uerra <span class="op">=</span> <span class="va">uerra</span>, outdir <span class="op">=</span> <span class="st">"output/CMIP5/"</span>, method <span class="op">=</span> <span class="st">"GLM"</span>, family_link <span class="op">=</span> <span class="st">"gaussian"</span>, spatial_pars <span class="op">=</span> <span class="va">spatial.pars</span>, global_nc_attributes <span class="op">=</span> <span class="va">global.nc.attributes</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Diego Nieto-Lugilde, Daniel Romera-Romera.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
